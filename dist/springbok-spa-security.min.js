!function(){"use-strict";const n=["ngCookies","springbok.core"],e=angular.module("springbok.security",n);e.run(["endpoints",function(n){n.add("accounts","accounts"),n.add("currentAccount","accounts/authenticated"),n.add("credentials","credentials")}])}(),function(){"use strict";function n(n,e,t,i,o){var a=this;a.session=t,this.login=function(){o.login().then(function(){n.$emit("Notify","success","SECURITY_LOGIN_SUCCESS"),n.$emit("AuthenticationChange"),_.isNull(i.url)||(e.path(i.url),i.url=null)},function(e){"wrongCredentials"===e.reason?n.$emit("Notify","error","SECURITY_LOGIN_INVALID"):n.$emit("Notify","error","ERROR_SERVER"),n.$emit("AuthenticationChange")})},this.logout=function(){o.logout(),a.account=o.account,n.$emit("Notify","warning","SECURITY_LOGIN_LOGOUT"),n.$emit("AuthenticationChange"),e.path("/")}}angular.module("springbok.security").controller("authenticationController",n),n.$inject=["$scope","$location","session","authenticationRedirect","authenticationService"]}(),function(){"use strict";angular.module("springbok.security").value("authenticationRedirect",{url:null})}(),function(){"use strict";function n(n,e,t,i,o,a){var r=this;r.logout=function(){delete e.defaults.headers.common.Authorization,o.clean(),a.clear(),t.clear()},r.login=function(){var a=n.defer();return t.setTokenAndExpiration(),e.get(i.get("currentAccount")).then(function(n){200===n.status&&(t.update(n.data),o.getCredentialsForUsername(t.account.username),a.resolve(n.infos))},function(n){r.logout(),403===n.status||401===n.status?a.reject({reason:"wrongCredentials"}):a.reject({reason:"serverError"})}),a.promise}}angular.module("springbok.security").service("authenticationService",n),n.$inject=["$q","$http","session","endpoints","credentialService","searchCriterias"]}(),function(){"use strict";function n(n,e,t){var i,o=[];return{getCredentialsForUsername:function(a){if(!_.isUndefined(o)&&o.length>0&&!_.isUndefined(i))return i;var r=t.defer(),c={params:{size:1e3,direction:"asc",properties:"label",username:a}};return e.get(n.get("credentials")+"/search",c).success(function(n){o=n.content,r.resolve(o)}),r.promise},hasCredential:function(n){var e=_.filter(o,function(e){return e.code===n});return e.length>0},setCredentials:function(n){o=n},clean:function(){o=[],i=null}}}angular.module("springbok.security").service("credentialService",n),n.$inject=["endpoints","$http","$q"]}(),function(){"use strict";function n(n){function e(){if(localStorage.account){var n=JSON.parse(localStorage.account);o.account=n}else i();return t(),o.account}function t(){var n=CONFIG.app.preferredLanguage;localStorage.language&&(n=localStorage.language),o.language=n}function i(){o.account={infos:{},username:"",password:"",expiration:null,authenticated:!1}}var o=this;o.defaultExpirationDurationInMilliseconds=36e5,o.account={},e(),o.persist=function(){localStorage.account=JSON.stringify(o.account)},o.update=function(n){o.account.infos=n,o.account.authenticated=!0,o.persist()},o.isExpired=function(){var n=!0,e=(new Date).getTime(),t=o.account.expiration;if(!_.isNull(t)&&!_.isUndefined(t)){var i=e-t;n=i>=o.defaultExpirationDurationInMilliseconds}return n},o.clear=function(){i(),localStorage.removeItem("account")},o.getCurrent=e,o.setTokenAndExpiration=function(){var e="Basic ";e+=n.encodeToBase64(o.account.username+":"+o.account.password),o.account.token=e,o.account.expiration=(new Date).getTime(),o.persist()},o.setDefaultExpirationDurationInMilliseconds=function(n){o.defaultExpirationDurationInMilliseconds=n},o.setLanguage=function(n){o.language=n,localStorage.language=o.language},o.updateLanguage=t()}angular.module("springbok.security").service("session",n),n.$inject=["encryptionUtils"]}();