!function(){"use-strict";const t=["ngCookies","springbok.core"],e=angular.module("springbok.security",t);e.run(["endpoints",function(t){t.add("accounts","accounts"),t.add("currentAccount","accounts/authenticated"),t.add("credentials","credentials")}])}(),function(){"use strict";function t(t,e,n,i,o){var c=this;c.session=n,this.login=function(){o.login().then(function(){t.$emit("Notify","success","SECURITY_LOGIN_SUCCESS"),t.$emit("AuthenticationChange"),_.isNull(i.url)||(e.path(i.url),i.url=null)},function(e){"wrongCredentials"===e.reason?t.$emit("Notify","error","SECURITY_LOGIN_INVALID"):t.$emit("Notify","error","ERROR_SERVER"),t.$emit("AuthenticationChange")})},this.logout=function(){o.logout(),c.account=o.account,t.$emit("Notify","warning","SECURITY_LOGIN_LOGOUT"),t.$emit("AuthenticationChange"),e.path("/")},console.log("authCtrl : session.account",n.account)}angular.module("springbok.security").controller("authenticationController",t),t.$inject=["$scope","$location","session","authenticationRedirect","authenticationService"]}(),function(){"use strict";angular.module("springbok.security").value("authenticationRedirect",{url:null})}(),function(){"use strict";function t(t,e,n,i,o,c){var r=this;r.logout=function(){delete e.defaults.headers.common.Authorization,o.clean(),c.clear(),n.clear()},r.login=function(){var c=t.defer();return n.setAuthorizationHeader(),e.get(i.get("currentAccount")).then(function(t){200===t.status&&(n.update(t.data),o.getCredentialsForUsername(n.account.username),c.resolve(t.infos))},function(t){r.logout(),403===t.status||401===t.status?c.reject({reason:"wrongCredentials"}):c.reject({reason:"serverError"})}),c.promise}}angular.module("springbok.security").service("authenticationService",t),t.$inject=["$q","$http","session","endpoints","credentialService","searchCriterias"]}(),function(){"use strict";function t(t,e,n){var i,o=[];return{getCredentialsForUsername:function(c){if(!_.isUndefined(o)&&o.length>0&&!_.isUndefined(i))return i;var r=n.defer(),a={params:{size:1e3,direction:"asc",properties:"label",username:c}};return e.get(t.get("credentials")+"/search",a).success(function(t){o=t.content,r.resolve(o)}),r.promise},hasCredential:function(t){var e=_.filter(o,function(e){return e.code===t});return e.length>0},setCredentials:function(t){o=t},clean:function(){o=[],i=null}}}angular.module("springbok.security").service("credentialService",t),t.$inject=["endpoints","$http","$q"]}(),function(){"use strict";function t(t){function e(){if(localStorage.account){var t=JSON.parse(localStorage.account);i.account=t}else n();return i.account}function n(){i.account={infos:{},username:"",password:"",authenticated:!1}}var i=this;i.account={},e(),i.persist=function(){localStorage.account=JSON.stringify(i.account)},i.update=function(t){i.account.infos=t,i.account.authenticated=!0,i.persist()},i.clear=function(){n(),localStorage.clear()},i.getCurrent=e,i.setAuthorizationHeader=function(){var e="Basic ";e+=t.encodeToBase64(i.account.username+":"+i.account.password),i.account.token=e,i.persist()}}angular.module("springbok.security").service("session",t),t.$inject=["encryptionUtils"]}();